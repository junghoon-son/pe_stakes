<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Occupation Explorer - Industry Trends | Clinicians.fyi</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,wide.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,wide.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/duckdb.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.14/_esm.js">
<link rel="modulepreload" href="./_npm/@duckdb/duckdb-wasm@1.28.0/_esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/apache-arrow@16.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/tslib@2.6.2/_esm.js">
<link rel="modulepreload" href="./_npm/flatbuffers@24.3.25/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile, FileAttachment} from "./_observablehq/stdlib.js";
import {registerTable} from "./_observablehq/stdlib/duckdb.js";

registerFile("./data/oes/processed/naics_lookup_from_data.csv", {"name":"./data/oes/processed/naics_lookup_from_data.csv","mimeType":"text/csv","path":"./_file/data/oes/processed/naics_lookup_from_data.6ae07ffb.csv","lastModified":1720171474814});
registerFile("./data/oes/processed/occ_code.csv", {"name":"./data/oes/processed/occ_code.csv","mimeType":"text/csv","path":"./_file/data/oes/processed/occ_code.6848eccf.csv","lastModified":1720171472882});
registerFile("./data/oes/processed/oes_longitudinal_slim.parquet", {"name":"./data/oes/processed/oes_longitudinal_slim.parquet","path":"./_file/data/oes/processed/oes_longitudinal_slim.876a428d.parquet","lastModified":1720171472815});
registerTable("oes_db", FileAttachment("./data/oes/processed/oes_longitudinal_slim.parquet"));

define({id: "b6ed26fa", inputs: ["FileAttachment"], outputs: ["occ_codes","naics_lookup"], body: (FileAttachment) => {
const occ_codes = FileAttachment("./data/oes/processed/occ_code.csv").csv()
const naics_lookup = FileAttachment("./data/oes/processed/naics_lookup_from_data.csv").csv()
return {occ_codes,naics_lookup};
}});

define({id: "56b0038b", inputs: ["occ_codes"], outputs: ["lookup_occ_title"], body: (occ_codes) => {
const lookup_occ_title = occ_code => 
  occ_codes.find(({ OCC_CODE }) => OCC_CODE === occ_code)?.OCC_TITLE;
return {lookup_occ_title};
}});

define({id: "1d499008", inputs: ["naics_lookup"], outputs: ["lookup_naics_title"], body: (naics_lookup) => {
const lookup_naics_title = naics_code => 
  naics_lookup.find(({ NAICS }) => NAICS === naics_code)?.NAICS_TITLE ?? naics_code;
return {lookup_naics_title};
}});

define({id: "da1c1422", inputs: ["sql","sql_array_str"], outputs: ["get_naics_counts"], body: (sql,sql_array_str) => {
const get_naics_counts = async function (selected_codes, grouping_limit=5) {
  const naics_occ_count = await sql([
    `WITH ranked_data AS (
      SELECT 
        REPORT_DATE,
        NAICS,
        ANY_VALUE(NAICS_TITLE) AS NAICS_TITLE,
        SUM(TOT_EMP) AS total_employment,
        RANK() OVER (PARTITION BY REPORT_DATE ORDER BY SUM(TOT_EMP) DESC) AS rank
      FROM oes_db
      WHERE OCC_CODE IN (${sql_array_str(selected_codes)}) 
        AND RIGHT(OCC_CODE, 1) != '0'
      GROUP BY REPORT_DATE, NAICS
    ),
    top_x_and_others AS (
      SELECT
        REPORT_DATE,
        CASE 
          WHEN rank <= ${grouping_limit} THEN NAICS 
          ELSE 'Other'
        END AS NAICS,
        SUM(total_employment) AS total_employment,
        ANY_VALUE(NAICS_TITLE) AS NAICS_TITLE
      FROM ranked_data
      GROUP BY 
        REPORT_DATE,
        CASE 
          WHEN rank <= ${grouping_limit} THEN NAICS 
          ELSE 'Other'
        END
    )
    SELECT 
      REPORT_DATE,
      NAICS,
      NAICS_TITLE,
      total_employment,
    FROM top_x_and_others
    ORDER BY 
      REPORT_DATE,
      CASE WHEN NAICS = 'Other' THEN 2 ELSE 1 END,
      total_employment DESC`
    ]);
  
  return await naics_occ_count
}
return {get_naics_counts};
}});

define({id: "0deddbdb", inputs: ["Inputs","occ_codes"], outputs: ["occ_code_search_input"], body: (Inputs,occ_codes) => {
const occ_code_search_input = Inputs.search(occ_codes, {width: 100})
return {occ_code_search_input};
}});

define({id: "90b4ba8e", inputs: ["Generators","occ_code_search_input"], outputs: ["occ_code_search"], body: (Generators,occ_code_search_input) => {
const occ_code_search = Generators.input(occ_code_search_input)
return {occ_code_search};
}});

define({id: "32d4a771", inputs: ["Inputs","occ_code_search"], outputs: ["occ_code_table_input"], body: (Inputs,occ_code_search) => {
const occ_code_table_input = Inputs.table(
    occ_code_search
)
return {occ_code_table_input};
}});

define({id: "2229528f", inputs: ["Generators","occ_code_table_input"], outputs: ["occ_code_table_input_results"], body: (Generators,occ_code_table_input) => {
const occ_code_table_input_results = Generators.input(occ_code_table_input)
return {occ_code_table_input_results};
}});

define({id: "7c4200c9", inputs: ["occ_code_table_input_results"], outputs: ["selected_codes"], body: (occ_code_table_input_results) => {
const selected_codes = occ_code_table_input_results.map(d => d.OCC_CODE)
return {selected_codes};
}});

define({id: "23844e66", inputs: ["occ_code_search_input","display"], body: async (occ_code_search_input,display) => {
display(await(
// OCC code search input box
occ_code_search_input
))
}});

define({id: "f87bf487", inputs: ["occ_code_table_input","display"], body: async (occ_code_table_input,display) => {
display(await(
// OCC code table
occ_code_table_input
))
}});

define({id: "9e14cb6c", inputs: ["get_naics_counts","selected_codes"], outputs: ["naics_total_employment"], body: async (get_naics_counts,selected_codes) => {
const naics_total_employment = await get_naics_counts(selected_codes)
return {naics_total_employment};
}});

define({id: "a140ef08", body: () => {
// selected_codes
}});

define({id: "0b40500c", inputs: ["Inputs"], outputs: ["grouping_limit_input"], body: (Inputs) => {
const grouping_limit_input = Inputs.range([0, 20], {step: 1, label: "Number of Top Categories", value: 4})
return {grouping_limit_input};
}});

define({id: "6941ebb8", inputs: ["Generators","grouping_limit_input"], outputs: ["grouping_limit"], body: (Generators,grouping_limit_input) => {
const grouping_limit = Generators.input(grouping_limit_input)
return {grouping_limit};
}});

define({id: "43344edb", inputs: ["grouping_limit_input","display"], body: async (grouping_limit_input,display) => {
display(await(
grouping_limit_input
))
}});

define({id: "1db0b415", mode: "inline", inputs: ["counts_plot","get_naics_counts","selected_codes","grouping_limit","display"], body: async (counts_plot,get_naics_counts,selected_codes,grouping_limit,display) => {
display(await(
counts_plot(await get_naics_counts(selected_codes, grouping_limit))
))
}});

define({id: "dd26fb29", inputs: ["Plot","lookup_occ_title","lookup_naics_title"], outputs: ["counts_plot"], body: (Plot,lookup_occ_title,lookup_naics_title) => {
const counts_plot = function(data) {
    return Plot.plot({
        // marginTop: 0,
        // paddingTop: 0,
        paddingLeft: 10,
        marginLeft: 120, 
        marginRight: 50, 
        marginBottom: 30,
        // height: 350,
        width: 1000,
        color: {
            legend: true,
            scheme: "Tableau10"
        },
        legend: {
            tickFormat: lookup_occ_title
        },
        x: {
          type: "band"
        },
        // facet: {data, x: "NAICS", marginRight: 90},
        marks: [
            Plot.barY(data, {
                x: (d) => new Date(d.REPORT_DATE),
                y: "total_employment", 
                fill: (d) => lookup_naics_title(d.NAICS),
                tip: true,
                title: (d) => `${d.NAICS_TITLE}: (${d.NAICS})\n\nEmployment: ${d.total_employment}`
            }),
            Plot.ruleY([0])
        ]
    })}
return {counts_plot};
}});

define({id: "5d02e7ec", inputs: ["Inputs","naics_total_employment","d3","display"], body: async (Inputs,naics_total_employment,d3,display) => {
display(await(
await Inputs.table(naics_total_employment,
  {
    align: {
      REPORT_DATE: "center",
      NAICS: "center",
      total_employment: "right"
    },
    format: {
      REPORT_DATE: (d) => new Date(d).toISOString().split('T')[0],
      total_employment: (d) => d3.format(",.0f")(d)
    },
  }
)
))
}});

define({id: "736097ba", inputs: ["selected_codes"], outputs: ["selected_codes_str"], body: (selected_codes) => {
// Join selected codes, turn it into SQL-compatible string. Inefficient but works
const selected_codes_str = "\'" + selected_codes.join("','") + "\'"
return {selected_codes_str};
}});

define({id: "f0fa738e", outputs: ["sql_array_str"], body: () => {
const sql_array_str = function (code_array) {
    const selected_codes_str = "\'" + code_array.join("','") + "\'"
    return selected_codes_str
}
return {sql_array_str};
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Clinicians.fyi</a></li>
  </ol>
  <details open>
    <summary>Healthcare Fraud</summary>
    <ol>
    <li class="observablehq-link"><a href="./healthcare-fraud">Criminal Cases</a></li>
    <li class="observablehq-link"><a href="./healthcare-fraud-startups">Startups/Health Tech</a></li>
    </ol>
  </details>
  <details open class="observablehq-section-active">
    <summary>Labor</summary>
    <ol>
    <li class="observablehq-link"><a href="./healthcare-labor">Healthcare Labor Statistics</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./occupation-search">Occupation Explorer</a></li>
    </ol>
  </details>
  <details open>
    <summary>Hospital Ownership</summary>
    <ol>
    <li class="observablehq-link"><a href="./pe_hospitals">PE Hospitals Tracker</a></li>
    </ol>
  </details>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#search-occupation">Search Occupation</a></li>
<li class="observablehq-secondary-link"><a href="#industries-(for-selected-occupation)">Industries (for Selected Occupation)</a></li>
</ol>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="occupation-explorer" tabindex="-1"><a class="observablehq-header-anchor" href="#occupation-explorer">Occupation Explorer</a></h1>
<hr style="padding: 0">
<div class="observablehq observablehq--block"><!--:b6ed26fa:--></div>
<div class="observablehq observablehq--block"><!--:56b0038b:--></div>
<div class="observablehq observablehq--block"><!--:1d499008:--></div>
<div class="observablehq observablehq--block"><!--:da1c1422:--></div>
<h2 id="search-occupation" tabindex="-1"><a class="observablehq-header-anchor" href="#search-occupation">Search Occupation</a></h2>
<p>Bureau of Labor Statistics uses "OCC" codes to capture occupations in the U.S. for reporting purposes. Full list is here: <a href="https://www.bls.gov/oes/current/oes_stru.htm" target="_blank" rel="noopener noreferrer">https://www.bls.gov/oes/current/oes_stru.htm</a></p>
<div class="observablehq observablehq--block"><!--:0deddbdb:--></div>
<div class="observablehq observablehq--block"><!--:90b4ba8e:--></div>
<div class="observablehq observablehq--block"><!--:32d4a771:--></div>
<div class="observablehq observablehq--block"><!--:2229528f:--></div>
<div class="observablehq observablehq--block"><!--:7c4200c9:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:23844e66:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:f87bf487:--></div>
<h2 id="industries-(for-selected-occupation)" tabindex="-1"><a class="observablehq-header-anchor" href="#industries-(for-selected-occupation)">Industries (for Selected Occupation)</a></h2>
<div class="observablehq observablehq--block"><!--:9e14cb6c:--></div>
<h3 id="total-employment-(2004-2023)" tabindex="-1"><a class="observablehq-header-anchor" href="#total-employment-(2004-2023)">Total Employment (2004-2023)</a></h3>
<div class="observablehq observablehq--block"><!--:a140ef08:--></div>
<div class="observablehq observablehq--block"><!--:0b40500c:--></div>
<div class="observablehq observablehq--block"><!--:6941ebb8:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:43344edb:--></div>
<div>
<observablehq-loading></observablehq-loading><!--:1db0b415:-->
</div>
<p>Source: Bureau of Labor Statistics</p>
<div class="observablehq observablehq--block"><!--:dd26fb29:--></div>
<hr>
<h3 id="table-of-naics-industries" tabindex="-1"><a class="observablehq-header-anchor" href="#table-of-naics-industries">Table of NAICS Industries</a></h3>
<div class="tip" label="">
<p>"The North American Industry Classification System (NAICS) is the standard used by Federal statistical agencies in classifying business establishments for the purpose of collecting, analyzing, and publishing statistical data related to the U.S. business economy." - <a href="https://www.census.gov/naics/" target="_blank" rel="noopener noreferrer">https://www.census.gov/naics/</a></p></div><p></p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:5d02e7ec:--></div>
<hr>
<div class="observablehq observablehq--block"><!--:736097ba:--></div>
<div class="observablehq observablehq--block"><!--:f0fa738e:--></div>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./healthcare-labor"><span>Healthcare Labor Statistics</span></a><a rel="next" href="./pe_hospitals"><span>PE Hospitals Tracker</span></a></nav>
<div>Built with Observable.</div>
</footer>
</div>
