<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Tutorial: PE Hospitals Tracker | Clinicians.fyi</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./dataloaders/pe-hospital-tracker.csv", {"name":"./dataloaders/pe-hospital-tracker.csv","mimeType":"text/csv","path":"./_file/dataloaders/pe-hospital-tracker.848d3d00.csv","lastModified":1712659086538});

define({id: "e0ad8bd7", inputs: ["FileAttachment"], outputs: ["pe_hospitals"], body: (FileAttachment) => {
const pe_hospitals = FileAttachment("./dataloaders/pe-hospital-tracker.csv").csv({typed: true})
return {pe_hospitals};
}});

define({id: "c8cdba37", inputs: ["pe_hospitals","display"], body: async (pe_hospitals,display) => {
display(await(
pe_hospitals
))
}});

define({id: "f549d640", inputs: ["pe_hospitals"], outputs: ["pe_options"], body: (pe_hospitals) => {
const pe_options = (
  pe_hospitals
  .filter(d => d['PE Firm'] !== null && d['PE Firm'].trim() !== '')
  .map((d) => d['PE Firm'])
)
return {pe_options};
}});

define({id: "41d330fb", inputs: ["pe_options","display"], body: async (pe_options,display) => {
display(await(
pe_options
))
}});

define({id: "91bfc200", inputs: ["Inputs","pe_options","Generators"], outputs: ["pe_firm_input","selected_pe_names"], body: (Inputs,pe_options,Generators) => {
const pe_firm_input = Inputs.select(
  pe_options,
  {
    label: "PE Firm", 
    sort: true,       
    value: ["formerly Leonard Green & Partners"],
    multiple: 10,
    unique: true,
    // width: "100%",
  }
)

// Generate an input based on the pe_names_input configuration
const selected_pe_names = Generators.input(pe_firm_input);
return {pe_firm_input,selected_pe_names};
}});

define({id: "c33dd523", inputs: ["pe_firm_input","display"], body: async (pe_firm_input,display) => {
display(await(
pe_firm_input
))
}});

define({id: "e740f788", inputs: ["selected_pe_names","display"], body: async (selected_pe_names,display) => {
display(await(
selected_pe_names
))
}});

define({id: "b6ed1b60", inputs: ["pe_hospitals","selected_pe_names","Inputs","Generators"], outputs: ["pe_hospitals_filtered","pe_hospital_table","pe_hospitals_selected"], body: (pe_hospitals,selected_pe_names,Inputs,Generators) => {
const pe_hospitals_filtered = pe_hospitals.filter(d => [...selected_pe_names].includes(d['PE Firm']))
const pe_hospital_table = Inputs.table(
    pe_hospitals_filtered,
    {
        rows: 15,
        sort: "Facility Name",
        value: pe_hospitals_filtered,
        width: {
            NAME: 250,
        },
        layout: "auto",
        required: false,
    })

// Assign the selected choices as an Array
const pe_hospitals_selected = Generators.input(pe_hospital_table)
return {pe_hospitals_filtered,pe_hospital_table,pe_hospitals_selected};
}});

define({id: "6335e62c", inline: true, inputs: ["pe_hospital_table","display"], body: async (pe_hospital_table,display) => {
display(await(
pe_hospital_table
))
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Clinicians.fyi</a></li>
  </ol>
  <div id="observablehq-search"><input type="search" placeholder="Search"></div>
  <div id="observablehq-search-results"></div>
  <script>{const o=document.querySelector("#observablehq-search");o.setAttribute("data-shortcut",`${/Mac|iPhone/.test(navigator.platform)?"\u2318":"Alt-"}K`);const t=o.querySelector("input"),r=()=>import("./_observablehq/search.js");t.addEventListener("focus",r,{once:!0}),t.addEventListener("keydown",r,{once:!0});const a=document.querySelector("#observablehq-sidebar-toggle");addEventListener("keydown",e=>{(e.code==="KeyK"&&e.metaKey&&!e.altKey&&!e.ctrlKey||e.key==="/"&&!e.metaKey&&!e.altKey&&!e.ctrlKey&&e.target===document.body)&&(a.classList.add("observablehq-sidebar-open"),t.focus(),t.select(),e.preventDefault())}),t.addEventListener("blur",()=>a.classList.remove("observablehq-sidebar-open"));}</script>
  <ol>
    <details open class="observablehq-section-active">
      <summary>PE Hospitals</summary>
      <ol>
    <li class="observablehq-link"><a href="./pe_hospitals">PE Hospitals Tracker</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./pe_hospitals_tutorial">üíª Tutorial</a></li>
      </ol>
    </details>
    <details open>
      <summary>üîç Looking for data</summary>
      <ol>
    <li class="observablehq-link"><a href="./340b">üíäüè• 340B (WIP)</a></li>
    <li class="observablehq-link"><a href="./pbm">üíäüè¢ PBM (WIP)</a></li>
      </ol>
    </details>
  </ol>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type), h2:first-child, :not(h1) + h2">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#1-dataloaders-basics">1 Dataloaders Basics</a></li>
<li class="observablehq-secondary-link"><a href="#1.1-write-your-dataloader">1.1 Write your dataloader</a></li>
<li class="observablehq-secondary-link"><a href="#1.2-load-the-dataloader">1.2 Load the dataloader</a></li>
<li class="observablehq-secondary-link"><a href="#1.3-input-selector">1.3 Input selector</a></li>
<li class="observablehq-secondary-link"><a href="#1.3%3A-interactive-table">1.3: Interactive Table</a></li>
</ol>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="tutorial%3A-pe-hospitals-tracker" tabindex="-1"><a class="observablehq-header-anchor" href="#tutorial%3A-pe-hospitals-tracker">Tutorial: PE Hospitals Tracker</a></h1>
<hr>
<h1 id="1-dataloaders-basics" tabindex="-1"><a class="observablehq-header-anchor" href="#1-dataloaders-basics">1 Dataloaders Basics</a></h1>
<p>Note that <code>Observable</code> likes to show the result output of the code first, followed by source code.</p>
<hr>
<h2 id="1.1-write-your-dataloader" tabindex="-1"><a class="observablehq-header-anchor" href="#1.1-write-your-dataloader">1.1 Write your dataloader</a></h2>
<p>Data loaders is one of the most intriguing pieces of Observable Framework. It allows users to write, in any of the language supported (R, Python, shell script).</p>
<p>The dataloader code for this project is located in <strong><code>dataloaders/pe-hospital-tracker.csv.py</code></strong> . I personally use Polars as my main data transformation.</p>
<p>After examining the file, I found the data useful for but I need some sort of geospatial information. Two options:</p>
<ul>
<li><strong>FIPS code</strong>: Allows choropleth maps since FIPS codes are mapped to polygons/shapefiles</li>
<li><strong>Latitude/Longitude</strong>: Allows pin-point</li>
</ul>
<pre data-language="py"><code class="language-py"><span class="hljs-keyword">import</span> polars <span class="hljs-keyword">as</span> pl
<span class="hljs-keyword">import</span> sys

<span class="hljs-comment"># Location is relative to the packson.json file</span>
pe_hospitals = (
    pl.read_csv(<span class="hljs-string">"docs/dataloaders/data/pe-hospital-tracker.csv"</span>, infer_schema_length=<span class="hljs-number">100000</span>)
)

state_fips = (
    pl.read_json(<span class="hljs-string">"docs/dataloaders/data/state-fips.json"</span>)
    .select(pl.col(<span class="hljs-string">"state"</span>).alias(<span class="hljs-string">"State"</span>), <span class="hljs-string">"fips"</span>)
)

df = pe_hospitals.join(state_fips, on=<span class="hljs-string">"State"</span>, how=<span class="hljs-string">"left"</span>)

<span class="hljs-comment"># Note the sys.stdout output, which is a requirement</span>
df.write_csv(sys.stdout)
</code></pre>
<div class="note">The magic of data loaders is that even though the file is a python file (**`.py`**), the data loader framework allows you to read this as if it's a CSV. 
</div>
<hr>
<h2 id="1.2-load-the-dataloader" tabindex="-1"><a class="observablehq-header-anchor" href="#1.2-load-the-dataloader">1.2 Load the dataloader</a></h2>
<p><code>FileAttachment()</code> can read either actual file or the dataloader-based file name re-routing (without the <code>.py</code> extension), as if you are loading a CSV file. Despite</p>
<div id="cell-e0ad8bd7" class="observablehq observablehq--block"></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> pe_hospitals = <span class="hljs-title class_">FileAttachment</span>(<span class="hljs-string">"dataloaders/pe-hospital-tracker.csv"</span>).<span class="hljs-title function_">csv</span>({<span class="hljs-attr">typed</span>: <span class="hljs-literal">true</span>})
</code></pre>
<div id="cell-c8cdba37" class="observablehq observablehq--block observablehq--loading"></div>
<pre data-language="js"><code class="language-js">pe_hospitals
</code></pre>
<hr>
<h2 id="1.3-input-selector" tabindex="-1"><a class="observablehq-header-anchor" href="#1.3-input-selector">1.3 Input selector</a></h2>
<p>Select unique values of <strong><code>PE Firm</code></strong> from the <strong><code>pe_hospitals</code></strong> Array object. These are private equity firms.</p>
<div id="cell-f549d640" class="observablehq observablehq--block"></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> pe_options = (
  pe_hospitals
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d[<span class="hljs-string">'PE Firm'</span>] !== <span class="hljs-literal">null</span> &amp;&amp; d[<span class="hljs-string">'PE Firm'</span>].<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> d[<span class="hljs-string">'PE Firm'</span>])
)
</code></pre>
<h4 id="pe_options" tabindex="-1"><a class="observablehq-header-anchor" href="#pe_options"><code>pe_options</code></a></h4>
<div id="cell-41d330fb" class="observablehq observablehq--block observablehq--loading"></div>
<hr>
<p>Then display it using <strong><code>Input.select()</code></strong> with options to make it multi-selectable with 10 rows displayed.</p>
<p>Notes:</p>
<ul>
<li><strong><code>multiple: false</code></strong> will result in a dropdown menu</li>
<li><strong><code>value: [default_selection]</code></strong></li>
</ul>
<h3 id="code" tabindex="-1"><a class="observablehq-header-anchor" href="#code">Code</a></h3>
<div id="cell-91bfc200" class="observablehq observablehq--block"></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> pe_firm_input = <span class="hljs-title class_">Inputs</span>.<span class="hljs-title function_">select</span>(
  pe_options,
  {
    <span class="hljs-attr">label</span>: <span class="hljs-string">"PE Firm"</span>, 
    <span class="hljs-attr">sort</span>: <span class="hljs-literal">true</span>,       
    <span class="hljs-attr">value</span>: [<span class="hljs-string">"formerly Leonard Green &amp; Partners"</span>],
    <span class="hljs-attr">multiple</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-comment">// width: "100%",</span>
  }
)

<span class="hljs-comment">// Generate an input based on the pe_names_input configuration</span>
<span class="hljs-keyword">const</span> selected_pe_names = <span class="hljs-title class_">Generators</span>.<span class="hljs-title function_">input</span>(pe_firm_input);
</code></pre>
<h3 id="output" tabindex="-1"><a class="observablehq-header-anchor" href="#output">Output</a></h3>
<p>Simple calling the <strong><code>pe_firm_input</code></strong> and <strong><code>selected_pe_names</code></strong> within <strong>```js</strong>``` code blocks will generate these:</p>
<div id="cell-c33dd523" class="observablehq observablehq--block observablehq--loading"></div>
<div id="cell-e740f788" class="observablehq observablehq--block observablehq--loading"></div>
<hr>
<h2 id="1.3%3A-interactive-table" tabindex="-1"><a class="observablehq-header-anchor" href="#1.3%3A-interactive-table">1.3: Interactive Table</a></h2>
<p>Using the selected names of the PEs, we can filter the JavaScript Array of <strong><code>pe_hospitals</code></strong>. I this the syntax will be unusual for python users but for people who've dabbled in JavaScript, the <strong><code>filter()</code></strong> and the hash rocket (=&gt;) syntax translated as python/pandas will very similar to:</p>
<ul>
<li>Python/pandas: <strong><code>df.apply(lambda row: selected_pe_names in row['PE Firm'])</code></strong></li>
</ul>
<div id="cell-b6ed1b60" class="observablehq observablehq--block"></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> pe_hospitals_filtered = pe_hospitals.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> [...selected_pe_names].<span class="hljs-title function_">includes</span>(d[<span class="hljs-string">'PE Firm'</span>]))
<span class="hljs-keyword">const</span> pe_hospital_table = <span class="hljs-title class_">Inputs</span>.<span class="hljs-title function_">table</span>(
    pe_hospitals_filtered,
    {
        <span class="hljs-attr">rows</span>: <span class="hljs-number">15</span>,
        <span class="hljs-attr">sort</span>: <span class="hljs-string">"Facility Name"</span>,
        <span class="hljs-attr">value</span>: pe_hospitals_filtered,
        <span class="hljs-attr">width</span>: {
            <span class="hljs-attr">NAME</span>: <span class="hljs-number">250</span>,
        },
        <span class="hljs-attr">layout</span>: <span class="hljs-string">"auto"</span>,
        <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,
    })

<span class="hljs-comment">// Assign the selected choices as an Array</span>
<span class="hljs-keyword">const</span> pe_hospitals_selected = <span class="hljs-title class_">Generators</span>.<span class="hljs-title function_">input</span>(pe_hospital_table)
</code></pre>
<p><span id="cell-6335e62c" class="observablehq--loading"></span></p>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./pe_hospitals"><span>PE Hospitals Tracker</span></a><a rel="next" href="./340b"><span>üíäüè• 340B (WIP)</span></a></nav>
<div>Built with Observable.</div>
</footer>
</div>
